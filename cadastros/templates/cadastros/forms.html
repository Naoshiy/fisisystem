{% extends 'paginas/index.html' %}
{% load static %}
{% load crispy_forms_tags %}

    <!-- Website Title -->
    {% block titulo %}
    <title>Material Entry </title>
    {% endblock %}     
    
    {% block body %} 
   <div class="form">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="text-container">
                        <div class="above-heading">Register Material </div>   
                        <script type="text/javascript" scr="{% static 'js/jquery-3.6.0.min.js' %}"></script>

  <!------------------table bill--------- -->
  <div id="tbl-bill">
    <table class="table table-striped" id="table-bill">
      <thead>
      <tr>
          <th>Bill Of Lading</th>
          <th>Date</th>
          <th>Vendor</th>
      </tr>
      </thead>
          <tbody class="tbody-bill">
          </tbody>
      </table> 
    </div>
  <!-- -------------- final table bill ------------- -->
 <!-- inicio formset -->            
          
            <form action="" method="POST">
            <div id="div1" style="color: rgb(89, 191, 223);">
                {% csrf_token %}
                {{ form }}
                <input type="button" value="Save" name="btn-bill" id="btn-bill" />
            </div>           

                <hr size=20 color="black" >

                {{ formset.management_form}}
               <!-- <legend class="lead">Material</legend> -->
               <div id="order" >
                   {% for x in formset %}
                       <div id="item-{{ forloop.counter0 }}">{{x|crispy}}</div>
                   {% endfor %}
               </div>

               <!-- table enter -->
               <input type="button" value="Add Mat" name="mat" id="mat"  />

               <button class="btn btn-primary pull-right" value="Save"> Save</button>
               <a class="btn btn-info" id="add-item"> Add Item</a>
               <a href="#" class="btn btn-warning pull-right"> Cancel</a>
           </form>
<!-- ------------------------------------------------------------- -->
            <div id="tbmaterial">
            <table class="table table-striped" id="table-list">
                <thead>
                    <tr>
                        <th>PO Number</th>
                        <th>Order Number</th>
                        <th>Sidemark</th>
                        <th>Carrier</th>
                        <th>Roll Number</th>
                        <th>Width</th>
                        <th>Length</th>  
                        <th>Qty Sy</th>
                        <th>Material Type</th>
                        <th>Store</th>
                        <th>Receiving Material</th>
                        <th>Material Desc.</th>
                        <th> Options </th>
                    </tr>
                </thead>
                <tbody class="tbody">
                </tbody>
            </table>  
<!-- final table -->
            
                    </div> <!-- end of text-container -->
                </div> <!-- end of col -->
            </div> <!-- end of row -->
            <div class="row"><!-- end of col -->
            </div> <!-- end of row -->
        </div> <!-- end of container -->
    </div> <!-- end of form -->
    <!-- body central -->
    {% endblock %}

    {% block scripts %}
    <script src="{% static 'js/jquery.mask.min.js' %}"></script>

    <script>
        $(document).ready(function(){
            $("#id_main-date").mask("00/00/0000"); 
        });
    </script>
    
<!-- ----------------soma campos----------- --------------- -->
    <script>
        jQuery(document).ready(function(){
    jQuery('input').on('keyup',function(){
    if(jQuery(this).attr('name') === 'result'){
    return false;
    }

    var soma1 = (jQuery('#id_material_type_set-0-length').val() == '' ? 0 : jQuery('#id_material_type_set-0-length').val());
    var soma2 = (jQuery('#id_material_type_set-0-width').val() == '' ? 0 : jQuery('#id_material_type_set-0-width').val());
    var result = (parseInt(soma1) * parseInt(soma2));
    jQuery('#id_material_type_set-0-Quantity').val(result);
    });
    });
    </script>
<!-- ----------------formulario dinamico--------------- -->
    <script>
        $(document).ready(function(){
            $("#add-item").click(function(ev) {
                ev.preventDefault();
                var count = $('#order').children().length;
                var tmplMarkup = $("#item-order").html();
                var compiledTmpl = tmplMarkup.replace(/__prefix__/g, count);
                $("div#order").append(compiledTmpl);

                // update form count
                $('#id_product-TOTAL_FORMS').attr('value', count + 1);

                // some animate to scroll to view our new form
                $('html, body').animate({
                    scrollTop: $("#add-item").position().top-200
                }, 800);

                
            });
        }); 

    </script>

    <script type="text/html" id="item-order">
        <div id="item-__prefix__" style="margin-top: 10px">
                {{ formset.empty_form|crispy }}
        </div>
    </script>

<!-- -------------- salva variaveis ------------ -->
    <script>
            $("#cap").click(function(){
                var bill=$("#id_main-bill_of_land").val();
                var date=$("#id_main-date").val();
                var vendor=$("#id_main-vendor").val();
                // alert(bill + date + vendor)
                
                
                // atualizando div 
                $( "#div1" ).load( "cadastros/forms1.html", function() {
                alert( bill + date + vendor +"Load was performed." );
            });
            });
    </script>


<!-- -----------material----------->
<!------------------- iteracao loop tabela forms ------------------->
<script>
    $(document).ready(function() {
        $('item-{{ forloop.counter0 }}').keyup(function() {
         $('#tag5').html('<b>' + $(this).val() + '</b>');
        });
    }); 
</script>


<script>   
// -------table cadastro bill ---------------

$("#btn-bill").click(function(){
    var Billoflading = $('#id_main-bill_of_land').val();    
    var date = $('#id_main-date').val();
    var vendor = $('#id_main-vendor').val();

    var linha = "" +
        "<tr>" +
           "<td>"+Billoflading+"</td>"+
           "<td>"+date+"</td>"+
           "<td>"+vendor+"</td>"+

           "  <td><a href='#' class='btn btn-danger btn-remove btn-xs'>Remove</a></td>"+
        "</tr>";
        $('.tbody-bill').append( linha );
        $('#id_main-date').val('');
        $('#id_main-vendor').val('');
});

    $(".tbody").on("click", "remove-list", function(e){
                $(this).closest('tr').remove();
            });

// ---------- original function---------------
$("#mat").click(function(){
    var POnumber = $('#id_product-TOTAL_FORMS').val();    
    var ordernumber = $('#id_product-0-Order_number').val();
    var SideMark = $('#id_product-0-Side_Mark').val();
    var Carrier = $('#id_product-0-carrier').val();
    var RollNumber = $('#id_product-0-Roll_number').val();
    var width = $('#id_product-0-width').val();
    var length = $('#id_product-0-length').val();
    var Quantity = $('#id_product-0-Quantity').val();
    var MaterialType = $('#id_product-0-material_type').val();
    var store = $('#id_product-0-store').val();

    var linha = "" +
        "<tr>" +
           "<td>"+POnumber+"</td>"+
           "<td>"+ordernumber+"</td>"+
           "<td>"+SideMark+"</td>"+
           "<td>"+Carrier+"</td>"+
           "<td>"+RollNumber+"</td>"+
           "<td>"+width+"</td>"+
           "<td>"+length+"</td>"+
           "<td>"+Quantity+"</td>"+
           "<td>"+MaterialType+"</td>"+
           "<td>"+store+"</td>"+
           "  <td><a href='#' class='btn btn-danger btn-remove btn-xs'>Remove</a></td>"+
        "</tr>";
        $('.tbody').append( linha );
        $('#id_product-0-PO_number').val('');
        $('#id_product-0-Order_number').val('');
        $('#id_product-0-Side_Mark').val('');
        $('#id_product-0-carrier').val('');
        $('#id_product-0-Roll_number').val('');
        $('#id_product-0-width').val('');
        $('#id_product-0-length').val('');
        $('#id_product-0-Quantity').val('');
        $('#id_product-0-material_type').val('');
        $('#id_product-0-store').val('');
});
// ------------------final function principal------------------
          $(".tbody").on("click", "remove-list", function(e){
              $(this).closest('tr').remove();
          }); 
</script>


    {% endblock %}

